<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>main</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome-all.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.ico">

  <!-- Google Analytics -->
  

</head>


  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">main</h2>
        </a>
        <ul>
          <li><a href="/">About</a></li>
          <li><a href="/portfolio/">Portfolio</a></li>
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <h2 class="post-title">CozyHouse</h2>
  <div class="post-line"></div>

  <h1 id="-cozyhouse">📌 CozyHouse</h1>
<p>“cinema”와 “broadcast”의 결합으로 영화를 브로드캐스팅하여 사용자에게 최신 영화 정보와 편리한 예매 서비스를 제공합니다.</p>

<h2 id="️-프로젝트-소개">🖥️ 프로젝트 소개</h2>
<p>스프링 부트를 이용해 오늘의 집 사이트를 참고하여 만든 쇼핑몰입니다.</p>

<h2 id="-프로젝트-구성원">👨‍👩‍👦 프로젝트 구성원</h2>
<ul>
  <li><strong>팀장</strong>: 김민석 - 프론트엔드</li>
  <li><strong>팀원1</strong>: 이병훈 - 백엔드</li>
  <li><strong>팀원2</strong>: 김준모 - 백엔드</li>
</ul>

<h2 id="️-사용된-기술">⚙️ 사용된 기술</h2>
<p>Java, Spring Boot, Spring Data JPA, Spring Security, MySQL</p>

<p><br /></p>

<h1 id="-담당-기능">💡 담당 기능</h1>

<h2 id="회원가입">회원가입</h2>
<ul>
  <li>OAuth2 방식을 사용하여 JWT를 이용한 회원가입 기능을 구현하였습니다.</li>
  <li>모든 회원가입 로직은 백엔드에서 처리합니다.</li>
</ul>

<h2 id="로그인-소셜로그인-로그아웃">로그인, 소셜로그인, 로그아웃</h2>
<ul>
  <li>OAuth2 방식으로 로그인 및 소셜 로그인 기능을 구현하였습니다.</li>
  <li>JWT를 사용하여 인증 토큰을 관리하고, 모든 인증 관련 로직은 백엔드에서 처리합니다.</li>
  <li>여러 필터를 커스터마이즈하여 로그인, 로그아웃 및 JWT 검증을 관리합니다.</li>
  <li>리프레시 토큰을 사용하여 세션 유지 기능을 구현하였으며, 리프레시 토큰 로테이션을 통해 보안성을 강화하였습니다.</li>
</ul>

<h2 id="전역예외처리">전역예외처리</h2>
<ul>
  <li>AOP를 활용해 애플리케이션 전반에 걸쳐 발생하는 예외를 처리합니다.</li>
</ul>

<h2 id="글쓰기">글쓰기</h2>
<ul>
  <li>파일 업로드를 위해 MultiparFile와 Java NIO를 사용하여 처리합니다.</li>
</ul>

<p><br /></p>

<h1 id="️-트러블슈팅-내용">🛠️ 트러블슈팅 내용</h1>

<h2 id="문제-상황">문제 상황</h2>
<ol>
  <li>소셜 로그인 구현 시, 일반 로그인처럼 엑세스 토큰과 리프레시 토큰을 HTTP 응답 헤더로 받으려 했습니다.</li>
  <li>그러나 하이퍼링크를 통해 리다이렉션되는 과정에서 응답 헤더에 직접 접근할 수 없는 상황이 발생했습니다.</li>
  <li>이로 인해 JWTFilter는 요청 헤더에서 받은 엑세스 쿠키로 인증을 하게 되었고, 이로 인해 일관성이 떨어지는 문제가 발생했습니다.</li>
</ol>

<h2 id="해결-방안">해결 방안</h2>
<ol>
  <li><strong>쿠키를 통한 토큰 전송</strong>
    <ul>
      <li>소셜 로그인 후, 엑세스 토큰과 리프레시 토큰을 서버에서 쿠키로 설정해 클라이언트에 전송.</li>
      <li>HttpOnly 속성을 사용하여 JavaScript에서 쿠키에 접근할 수 없도록 설정해 XSS 공격에 대한 보안을 강화.</li>
    </ul>
  </li>
  <li><strong>엑세스 토큰 요청 헤더로 변환</strong>
    <ul>
      <li>로그인 성공 핸들러를 통해 JWT를 발급하는 방식이 쿠키와 헤더로 다르기 때문에, 쿠키에 저장된 엑세스 토큰을 클라이언트에서 요청 헤더로 변환하여 백엔드에 요청.</li>
      <li>서버에서 새로운 엑세스 토큰을 응답 헤더로 받아올 수 있도록 하여 JWTFilter의 일관성을 유지하고, 모든 인증 로직을 요청 헤더 방식으로 통합.</li>
    </ul>
  </li>
  <li><strong>로컬 스토리지에 저장</strong>
    <ul>
      <li>서버에서 받은 엑세스 토큰은 로컬 스토리지에 저장해 클라이언트에서 쉽게 접근할 수 있도록 설정.</li>
      <li>로컬 스토리지에 저장된 토큰이 XSS 공격에 노출되지 않도록 콘텐츠 보안 정책(CSP, Content Security Policy)을 설정.</li>
    </ul>
  </li>
</ol>

<h2 id="결론">결론</h2>
<ol>
  <li>소셜 로그인 과정에서 하이퍼링크로 인한 리다이렉션 문제 때문에, 쿠키를 사용해 토큰을 전송하는 방식을 선택했습니다.</li>
  <li>이후, 엑세스 토큰을 요청 헤더로 변환하여 클라이언트에 전달함으로써 일관성을 유지했습니다.</li>
  <li>로그인 성공 핸들러에서 JWT 발급 방식을 통합해 JWTFilter의 일관성을 확보했으며, 이는 보안과 사용성을 동시에 고려한 해결책으로 효과적으로 적용되었습니다.</li>
</ol>

<h2 id="느낀-점">느낀 점</h2>
<ol>
  <li>JWT 토큰을 활용하여 쿠키와 요청 헤더를 조합한 인증 방식이 효과적이라는 것을 깨달았습니다.</li>
  <li>특히 HttpOnly 속성의 중요성을 통해 XSS 공격 방어를 강화할 수 있음을 배웠고, CSP(Content Security Policy)와 로컬 스토리지로 클라이언트 측 보안을 높일 수 있었습니다.</li>
  <li>이번 경험을 통해 웹 보안의 중요성을 깊이 이해하게 되었고, 앞으로 JWT를 활용해 안전하고 효율적인 시스템을 구축하는 데 기여하고 싶습니다.</li>
</ol>

<p><br /></p>

<h1 id="프로젝트-설정">프로젝트 설정</h1>

<p>이 프로젝트를 실행하기 위해서는 몇 가지 환경 설정이 필요합니다. 아래의 단계를 따라주세요.</p>

<h2 id="1-데이터베이스-설정">1. 데이터베이스 설정</h2>
<ol>
  <li>MySQL에서 cozy-house 데이터베이스를 생성합니다.</li>
  <li>아래의 정보를 바탕으로 application.properties 파일을 설정합니다.</li>
</ol>

<h2 id="2-applicationproperties-설정">2. application.properties 설정</h2>

<p>src/main/resources/application.properties 파일을 다음과 같이 생성 후 설정합니다:</p>

<ul>
  <li>
    <h3 id="애플리케이션-이름-및-포트">애플리케이션 이름 및 포트</h3>
    <p>spring.application.name=backend<br />
server.port=8081</p>
  </li>
  <li>
    <h3 id="파일-업로드-디렉토리">파일 업로드 디렉토리</h3>
    <p>file.upload-dir=C:\파일경로\file\<br />
spring.servlet.multipart.enabled=true<br />
spring.servlet.multipart.max-file-size=50MB<br />
spring.servlet.multipart.max-request-size=50MB</p>
  </li>
  <li>
    <h3 id="mysql-설정">MySQL 설정</h3>
    <p>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver<br />
spring.datasource.url=YOUR_URL_HERE<br />
spring.datasource.username=YOUR_username_HERE<br />
spring.datasource.password=YOUR_PASSWORD_HERE</p>
  </li>
  <li>
    <h3 id="jpa-설정">JPA 설정</h3>
    <p>spring.jpa.properties.hibernate.show_sql=true<br />
spring.jpa.properties.hibernate.format_sql=true<br />
spring.jpa.hibernate.ddl-auto=update<br />
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect<br />
spring.jackson.property-naming-strategy=SNAKE_CASE<br />
spring.jwt.secret=YOUR_SECRET_KEY_HERE</p>
  </li>
  <li>
    <h3 id="보안-로깅">보안 로깅</h3>
    <p>logging.level.org.springframework.security=DEBUG</p>
  </li>
  <li>
    <h3 id="kakao-oauth2">kakao OAuth2</h3>
    <p>spring.security.oauth2.client.registration.kakao.client-name=Kakao<br />
spring.security.oauth2.client.registration.kakao.client-id=YOUR_CLIENT_ID<br />
spring.security.oauth2.client.registration.kakao.client-secret=YOUR_CLIENT_SECRET<br />
spring.security.oauth2.client.registration.kakao.redirect-uri=http://localhost:8081/login/oauth2/code/kakao<br />
spring.security.oauth2.client.registration.kakao.authorization-grant-type=authorization_code<br />
spring.security.oauth2.client.registration.kakao.scope=account_email, profile_nickname<br />
spring.security.oauth2.client.registration.kakao.client-authentication-method=client_secret_post<br />
spring.security.oauth2.client.provider.kakao.authorization-uri=https://kauth.kakao.com/oauth/authorize<br />
spring.security.oauth2.client.provider.kakao.token-uri=https://kauth.kakao.com/oauth/token<br />
spring.security.oauth2.client.provider.kakao.user-info-uri=https://kapi.kakao.com/v2/user/me<br />
spring.security.oauth2.client.provider.kakao.user-name-attribute=id</p>
  </li>
  <li>
    <h3 id="google-oauth2">Google OAuth2</h3>
    <p>spring.security.oauth2.client.registration.google.client-name=google<br />
spring.security.oauth2.client.registration.google.client-id=YOUR_CLIENT_ID<br />
spring.security.oauth2.client.registration.google.client-secret=YOUR_CLIENT_SECRET<br />
spring.security.oauth2.client.registration.google.redirect-uri=http://localhost:8081/login/oauth2/code/google<br />
spring.security.oauth2.client.registration.google.authorization-grant-type=authorization_code<br />
spring.security.oauth2.client.registration.google.scope=profile,email</p>
  </li>
  <li>
    <h3 id="github-oauth2">GitHub OAuth2</h3>
    <p>spring.security.oauth2.client.registration.github.client-name=GitHub<br />
spring.security.oauth2.client.registration.github.client-id=YOUR_CLIENT_ID<br />
spring.security.oauth2.client.registration.github.client-secret=YOUR_CLIENT_SECRET<br />
spring.security.oauth2.client.registration.github.redirect-uri=http://localhost:8081/login/oauth2/code/github<br />
spring.security.oauth2.client.registration.github.authorization-grant-type=authorization_code<br />
spring.security.oauth2.client.registration.github.scope=SCOPE_read:user,SCOPE_user:email<br />
spring.security.oauth2.client.registration.github.client-authentication-method=client_secret_post<br />
spring.security.oauth2.client.provider.github.authorization-uri=https://github.com/login/oauth/authorize<br />
spring.security.oauth2.client.provider.github.token-uri=https://github.com/login/oauth/access_token<br />
spring.security.oauth2.client.provider.github.user-info-uri=https://api.github.com/user<br />
spring.security.oauth2.client.provider.github.user-name-attribute=id</p>
  </li>
  <li>
    <h3 id="naver-oauth2">Naver OAuth2</h3>
    <p>spring.security.oauth2.client.registration.naver.client-name=naver<br />
spring.security.oauth2.client.registration.naver.client-id=YOUR_CLIENT_ID<br />
spring.security.oauth2.client.registration.naver.client-secret=YOUR_CLIENT_SECRET<br />
spring.security.oauth2.client.registration.naver.redirect-uri=http://localhost:8081/login/oauth2/code/naver<br />
spring.security.oauth2.client.registration.naver.authorization-grant-type=authorization_code<br />
spring.security.oauth2.client.registration.naver.scope=name,email<br />
spring.security.oauth2.client.provider.naver.authorization-uri=https://nid.naver.com/oauth2.0/authorize<br />
spring.security.oauth2.client.provider.naver.token-uri=https://nid.naver.com/oauth2.0/token<br />
spring.security.oauth2.client.provider.naver.user-info-uri=https://openapi.naver.com/v1/nid/me<br />
spring.security.oauth2.client.provider.naver.user-name-attribute=response</p>
  </li>
  <li>
    <h3 id="coolsms-설정회원가입-인증코드-비활성화했습니다">CoolSMS 설정(회원가입 인증코드 비활성화했습니다.)</h3>
    <p>coolsms.api.key=YOUR_COOLSMS_API_KEY<br />
coolsms.api.secret=YOUR_COOLSMS_API_SECRET<br />
coolsms.from=YOUR_COOLSMS_FROM_NUMBER</p>
  </li>
  <li>
    <h3 id="redis-설정">Redis 설정</h3>
    <p>spring.data.redis.host=localhost<br />
spring.data.redis.port=6379</p>
  </li>
</ul>

<h2 id="3-프론트엔드-실행방법">3. 프론트엔드 실행방법</h2>
<ol>
  <li>프론트엔드 디렉터리 이동
    <ul>
      <li>cd frontend</li>
    </ul>
  </li>
  <li>의존성 설치
    <ul>
      <li>npm install</li>
    </ul>
  </li>
  <li>애플리케이션 설치
    <ul>
      <li>npm run dev</li>
    </ul>
  </li>
</ol>


</div>

<div class="pagination">
  
  
    <a href="/2024-07-02/CinemaCast" class="right next">Next</a>
  

  <a href="#" class="top">Top</a>
</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2024-09-19 20:17:08 +0900">2024</time> 이병훈. <a href="https://github.com/kssim/about-portfolio/">A.P</a> theme by kssim.
      </span>
    </footer>
  </body>
</html>
